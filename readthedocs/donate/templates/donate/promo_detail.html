{% extends "base.html" %}

{% load i18n %}
{% load static %}

{% block title %}{% trans "Promo Detail" %}{% endblock %}

{% block content %}

<h1> Promo Results </h1>

{% if promos %}

{% if promos|length > 1 %}
<p>
<strong>Total Clicks for all shown promos</strong>: {{ total_clicks }}
</p>
{% endif %}

<div id="promo_detail">
{% for promo in promos %}

<h3>
Results for {{ promo.name }} ({{ promo.analytics_id }}) over last {{ days }} days.
</h3>

<div class="example" style="width: 30%;">

  <div class="filters">
    {% if promo.programming_language %}
      <p> 
        <strong>Filtered Language</strong>: {{ promo.programming_language }}
      </p>
    {% endif %}

    {% if promo.geo_filters.count %}
      <p> 
      <strong>Filtered Geos</strong>: 
        {% for geo in promo.geo_filters.all %}
          {{ geo.countries.all|join:", " }}
        {% endfor %}
      </p>
    {% endif %}

    {% if promo.sold_clicks %}
      <p> 
        <strong>Total Clicks Sold</strong>: {{ promo.sold_clicks }}
      </p>
    {% endif %}
  </div>

  <a href="{{ promo.link }}">
    <img width=120 height=90 src="{{ promo.image }}">
  </a>

  <br>

  <div class="promo_text">
    {{ promo.report_html_text|safe }}
  </div>

  <br>

</div>

<h5>Promo Data</h5>
<table>
  <tr>
    <th><strong>Day (UTC)</strong></th>
    <th><strong>Views</strong></th> 
    <th><strong>Clicks</strong></th>
    <th><strong>CTR</strong></th>
  </tr>
  {% for day in promo.impressions.all|slice:days_slice %}
  {% if day.views > 0 %}
  <tr>
    <td>{{ day.date }}</td>
    <td><code>{{ day.views }}</code></td> 
    <td><code>{{ day.clicks }}</code></td>
    <td><code>{{ day.click_ratio }}%</code></td>
  </tr>
  {% endif %}
  {% endfor %}
  <tr>
    <td><strong>Total (over all time)</strong> </td>
    <td><strong>{{ promo.total_views }}</strong></td> 
    <td><strong>{{ promo.total_clicks }}</strong></td>
    <td><strong>{{ promo.total_click_ratio }}%</strong></td>
  </tr>
</table>

{% endfor %}
</div>

{% else %}

No promos match this query.

{% endif %}

{% endblock %}
