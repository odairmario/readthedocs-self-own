{% extends "profiles/base_profile_edit.html" %}
{% load static %}
{% load i18n %}

{% block profile-admin-gold-edit %}active{% endblock %}

{% block title %}
Read the Docs Gold
{% endblock %}

{% block extra_links %}
  <link rel="stylesheet" href="{% static 'payments/css/form.css' %}" />
{% endblock %}

{% block extra_scripts %}
  <script src="https://js.stripe.com/v3/" type="text/javascript"></script>
  <script type="text/javascript">
    var createCheckoutSession = function(priceId) {
        var csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value
        return fetch("{% url "gold_checkout_create" %}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrftoken
            },
            body: JSON.stringify({
                priceId: priceId
            })
        });
    };

    var publishableKey;
    //<![CDATA[
    publishableKey = '{{ stripe_publishable }}';
    //]]>
    var stripe = Stripe(publishableKey);

    $(document).ready(function () {
        document
            .getElementById("submit")
            .addEventListener("click", function(event) {
                // Avoid submitting the form
                event.preventDefault();

                priceId = document.getElementById("id_level").value;
                createCheckoutSession(priceId).then(function(result) {
                    // Call Stripe.js method to redirect to the new Checkout page
                    result.json().then(function(data) {
                        stripe
                            .redirectToCheckout({
                                sessionId: data.session_id
                            })
                    });
                });
            });
     });
  </script>
{% endblock %}

{% block edit_content %}
  <div>
    <h2>{% trans 'Read the Docs Gold Membership' %}</h2>

    <p>
      {% blocktrans trimmed %}
        Supporting Read the Docs lets us work more on features that people love.
        Your money will go directly to maintenance and development of the
        product.
      {% endblocktrans %}
    </p>

    <p>
    {% blocktrans trimmed %}
      Becoming a Gold member makes Read the Docs ad-free when you are logged-in.
      Gold members may also completely remove advertising for all visitors to their projects.
    {% endblocktrans %}
    </p>

    <ul class="donate-about">
      <li>{% trans 'For small businesses or personal projects, we ask for $5 per month to remove ads from a project.' %}</li>
      <li>{% trans 'For corporate supported open source projects, we ask for a $50 membership in order to cover our support and operations costs.' %}</li>
    </ul>

    <p>
    {% blocktrans trimmed %}
      If you are a company using Read the Docs,
      please consider <a href="https://readthedocs.com/">Read the Docs for Business</a>.
      This will help us cover our costs,
      and provide you with a better experience on the site.
    {% endblocktrans %}
    </p>

    <p>
      {% blocktrans trimmed %}
        For any questions about our Gold membership program,
        please <a href="mailto:rev@readthedocs.org?subject=Gold%20membership%20questions">email us</a>.
      {% endblocktrans %}
    </p>

    {% trans "Become a Gold member" as subscription_title %}
    {% if golduser %}
      {% trans "Update Your Subscription" as subscription_title %}
    {% endif %}
    <h3>{{ subscription_title }}</h3>

    <form accept-charset="UTF-8" action="" method="post" id="gold-register" class="payment">
      {% csrf_token %}

      {{ form }}

      {% trans "Sign Up" as form_submit_text %}
      {% if golduser %}
        {% trans "Manage subscription" as form_submit_text %}
      {% endif %}
      <input id="submit" type="submit" value="{{ form_submit_text }}" />
    </form>
  </div>
{% endblock %}
